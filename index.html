<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Four Horsemen Deck Validator — Staging V2.0</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 0; }
    header { background: #222; padding: 1em; text-align: center; font-size: 1.5em; }
    main { padding: 1em; max-width: 900px; margin: auto; }
    textarea { width: 100%; height: 200px; background: #222; color: #eee; border: 1px solid #444; padding: 10px; }
    button { margin-top: 10px; padding: 10px 20px; background: #4CAF50; border: none; border-radius: 5px; cursor: pointer; color: white; }
    button:hover { background: #45a049; }
    .results { margin-top: 20px; padding: 15px; background: #1c1c1c; border: 1px solid #333; border-radius: 8px; }
    .error { color: #f55; }
    .success { color: #5f5; }
  </style>
</head>
<body>
  <header>
    Four Horsemen Old School Magic — Deck Validator
  </header>
  <main>
    <p>Paste your decklist below (one card per line):</p>
    <textarea id="deckInput" placeholder="e.g.
Black Lotus
Shivan Dragon
... "></textarea>
    <button onclick="validateDeck()">Validate Deck</button>
    <div id="results" class="results"></div>
  </main>
  <script>
    async function loadCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return text.split("\n").map(row => row.trim()).filter(row => row);
    }

    async function validateDeck() {
      const deckText = document.getElementById("deckInput").value.trim();
      if (!deckText) {
        document.getElementById("results").innerHTML = '<p class="error">Please paste a decklist.</p>';
        return;
      }

      const deck = deckText.split("\n").map(card => card.trim());

      // Load card pool + banlist
      const cardPool = await loadCSV("4hm_card_pool_cleaned_utf8_bom.csv");
      const banList = await loadCSV("4HM_banlist.csv");

      let errors = [];

      // Rule: Deck must be at least 60 cards
      if (deck.length < 60) {
        errors.push(`Deck only has ${deck.length} cards. Minimum is 60.`);
      }

      // Rule: No banned cards
      deck.forEach(card => {
        if (banList.includes(card)) {
          errors.push(`${card} is banned.`);
        }
      });

      // Count categories
      let legendaryCount = 0;
      let rarelyPlayedCount = 0;

      // For demo purposes, mark any card with 'Legendary' as legendary creature,
      // and any card with 'Rarely' as rarely played. Adjust with real metadata.
      deck.forEach(card => {
        if (/legendary/i.test(card)) legendaryCount++;
        if (/rarely/i.test(card)) rarelyPlayedCount++;
      });

      // Rule: Must include at least 6 Legendary Creatures
      if (legendaryCount < 6) {
        errors.push(`Only ${legendaryCount} legendary creatures found. Minimum is 6.`);
      }

      // Rule: Must include at least 4 rarely played cards (not counting legendary creatures)
      if (rarelyPlayedCount < 4) {
        errors.push(`Only ${rarelyPlayedCount} rarely played cards found (exclusive of legendary creatures). Minimum is 4.`);
      }

      // Display results
      if (errors.length > 0) {
        document.getElementById("results").innerHTML = '<p class="error">Deck Invalid:</p><ul>' + errors.map(e => `<li>${e}</li>`).join("") + '</ul>';
      } else {
        document.getElementById("results").innerHTML = '<p class="success">Deck is valid!</p>';
      }
    }
  </script>
</body>
</html>
